<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>MENYRA ‚Äì Story</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    *{ margin:0; padding:0; box-sizing:border-box; font-family:Inter,system-ui,-apple-system,"Segoe UI",sans-serif; }
    html,body{ height:100%; background:#000; color:#fff; }
    body{ overflow:hidden; }

    /* ====== FEED (TikTok-Style) ====== */
    .feed{
      height:100vh;
      overflow-y:auto;
      scroll-snap-type:y mandatory;
      -webkit-overflow-scrolling:touch;
      background:#000;
    }
    .feed::-webkit-scrollbar{ display:none; }
    .feed{ -ms-overflow-style:none; scrollbar-width:none; }

    .reel{
      height:100vh;
      width:100%;
      scroll-snap-align:start;
      position:relative;
      background:#000;
      overflow:hidden;
    }

    .reel video{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      background:#000;
    }

    /* ====== OVERLAYS ====== */
    .topbar{
      position:fixed;
      left:0; right:0;
      top:0;
      padding: calc(env(safe-area-inset-top, 0px) + 12px) 14px 10px;
      z-index:50;
      display:flex;
      align-items:center;
      gap:10px;
      pointer-events:none;
      background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
    }
    .topbar > *{ pointer-events:auto; }

    .backBtn{
      width:40px; height:40px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
    }
    .backBtn svg{ width:20px; height:20px; fill:#fff; }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .brandLogo{
      width:34px; height:34px;
      border-radius:10px;
      object-fit:contain;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.10);
    }
    .brandText{
      display:flex;
      flex-direction:column;
      min-width:0;
      line-height:1.05;
    }
    .brandName{
      font-weight:800;
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandSub{
      font-size:12px;
      opacity:.78;
      margin-top:3px;
    }

    /* Right actions */
    .actions{
      position:absolute;
      right:12px;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 108px);
      z-index:20;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      pointer-events:auto;
    }
    .actionBtn{
      width:46px; height:46px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      transition: transform .12s ease, background .18s ease;
    }
    .actionBtn:active{ transform: scale(.98); background: rgba(0,0,0,.5); }
    .actionBtn svg{ width:22px; height:22px; fill:#fff; opacity:.95; }
    .actionCount{
      font-size:12px;
      font-weight:700;
      opacity:.92;
      margin-top:6px;
      text-align:center;
    }
    .actionStack{ display:flex; flex-direction:column; align-items:center; gap:6px; }

    .isLiked .likeIcon{
      fill:#ff5a5f !important;
    }

    /* Caption bottom-left */
    .meta{
      position:absolute;
      left:14px;
      right:78px;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 120px);
      z-index:18;
      pointer-events:none;
      text-shadow: 0 10px 30px rgba(0,0,0,.55);
    }
    .metaTitle{
      font-weight:800;
      font-size:14px;
      margin-bottom:8px;
    }
    .metaDesc{
      font-size:13px;
      opacity:.92;
      line-height:1.35;
      max-width: 92%;
    }

    /* Product tag card (bottom) */
    .productCard{
      position:absolute;
      left:14px;
      right:78px;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 18px);
      z-index:25;

      display:flex;
      align-items:center;
      gap:12px;

      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(8px);

      pointer-events:auto;
    }
    .productCard.is-hidden{ display:none; }

    .productImg{
      width:52px; height:52px;
      border-radius:12px;
      object-fit:cover;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .productInfo{ min-width:0; flex:1; }
    .productName{
      font-weight:800;
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-bottom:4px;
    }
    .productPrice{
      font-size:12px;
      opacity:.86;
      font-weight:700;
    }
    .productBtn{
      border:none;
      height:36px;
      padding:0 12px;
      border-radius:999px;
      background:#fff;
      color:#0f172a;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      flex:0 0 auto;
    }

    /* Tap indicator */
    .tapHint{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%, -50%) scale(1);
      z-index:30;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.16);
      padding:10px 14px;
      border-radius:999px;
      font-weight:800;
      font-size:12px;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .tapHint.show{
      opacity:1;
      transform: translate(-50%, -50%) scale(1.02);
    }

    /* Comments drawer (placeholder) */
    .comments{
      position:fixed;
      left:0; right:0;
      bottom:0;
      height:72vh;
      z-index:80;
      background:#0b1220;
      border-top-left-radius:22px;
      border-top-right-radius:22px;
      transform: translateY(100%);
      transition: transform .22s ease;
      box-shadow: 0 -18px 40px rgba(0,0,0,.45);
      padding: 14px;
    }
    .comments.open{ transform: translateY(0); }
    .commentsHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 6px 2px 10px;
    }
    .commentsTitle{ font-weight:900; font-size:14px; }
    .commentsClose{
      width:40px; height:40px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .commentsClose svg{ width:20px; height:20px; fill:#fff; }
    .commentsBody{
      opacity:.85;
      font-size:13px;
      line-height:1.45;
      padding-top:8px;
    }
  </style>
</head>

<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <button class="backBtn" id="backBtn" type="button" aria-label="Back">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.5 19.5L8 12l7.5-7.5 1.8 1.8L11.6 12l5.7 5.7-1.8 1.8z"/></svg>
    </button>

    <div class="brand" aria-label="Restaurant">
      <img class="brandLogo" src="./images/Prince-coffe-house-logo.jpg" alt="Logo" />
      <div class="brandText">
        <div class="brandName" id="brandName">Prince Coffe House</div>
        <div class="brandSub">Story</div>
      </div>
    </div>
  </header>

  <!-- FEED -->
  <main class="feed" id="feed">
    <!-- Reel 1 -->
    <section class="reel" data-reel="0">
      <video class="reelVideo" playsinline muted loop preload="metadata" src="./images/tik1.mp4"></video>

      <div class="tapHint">Paused</div>

      <div class="actions">
        <div class="actionStack">
          <button class="actionBtn likeBtn" type="button" aria-label="Like">
            <svg class="likeIcon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21s-7-4.6-9.5-8.6C.8 9.1 2.2 5.9 5.6 5.1c1.7-.4 3.4.2 4.6 1.4 1.2-1.2 2.9-1.8 4.6-1.4 3.4.8 4.8 4 3.1 7.3C19 16.4 12 21 12 21z"/>
            </svg>
          </button>
          <div class="actionCount likeCount">128</div>
        </div>

        <div class="actionStack">
          <button class="actionBtn commentBtn" type="button" aria-label="Comments">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 4h16v12H7l-3 3V4zm3 5h10v2H7V9zm0-4h10v2H7V5zm0 8h7v2H7v-2z"/>
            </svg>
          </button>
          <div class="actionCount commentCount">24</div>
        </div>
      </div>

      <div class="meta">
        <div class="metaTitle">@princecoffee</div>
        <div class="metaDesc">Fresh vibes ‚òïÔ∏èüî• Heute: Burger & Fries Deal.</div>
      </div>

      <div class="productCard" data-has-product="1">
        <img class="productImg" src="./images/speise1.avif" alt="Product" />
        <div class="productInfo">
          <div class="productName">Burger + Fries</div>
          <div class="productPrice">5.90 ‚Ç¨</div>
        </div>
        <button class="productBtn" type="button">View</button>
      </div>
    </section>

    <!-- Reel 2 -->
    <section class="reel" data-reel="1">
      <video class="reelVideo" playsinline muted loop preload="metadata" src="./images/tik2.mp4"></video>

      <div class="tapHint">Paused</div>

      <div class="actions">
        <div class="actionStack">
          <button class="actionBtn likeBtn" type="button" aria-label="Like">
            <svg class="likeIcon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21s-7-4.6-9.5-8.6C.8 9.1 2.2 5.9 5.6 5.1c1.7-.4 3.4.2 4.6 1.4 1.2-1.2 2.9-1.8 4.6-1.4 3.4.8 4.8 4 3.1 7.3C19 16.4 12 21 12 21z"/>
            </svg>
          </button>
          <div class="actionCount likeCount">76</div>
        </div>

        <div class="actionStack">
          <button class="actionBtn commentBtn" type="button" aria-label="Comments">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 4h16v12H7l-3 3V4zm3 5h10v2H7V9zm0-4h10v2H7V5zm0 8h7v2H7v-2z"/>
            </svg>
          </button>
          <div class="actionCount commentCount">9</div>
        </div>
      </div>

      <div class="meta">
        <div class="metaTitle">@princecoffee</div>
        <div class="metaDesc">Coffee art ‚ú® Cappuccino moment.</div>
      </div>

      <div class="productCard is-hidden" data-has-product="0">
        <img class="productImg" src="./images/getr√§nk1.png" alt="Product" />
        <div class="productInfo">
          <div class="productName">Cappuccino</div>
          <div class="productPrice">2.90 ‚Ç¨</div>
        </div>
        <button class="productBtn" type="button">View</button>
      </div>
    </section>

    <!-- Reel 3 -->
    <section class="reel" data-reel="2">
      <video class="reelVideo" playsinline muted loop preload="metadata" src="./images/tik3.mp4"></video>

      <div class="tapHint">Paused</div>

      <div class="actions">
        <div class="actionStack">
          <button class="actionBtn likeBtn" type="button" aria-label="Like">
            <svg class="likeIcon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21s-7-4.6-9.5-8.6C.8 9.1 2.2 5.9 5.6 5.1c1.7-.4 3.4.2 4.6 1.4 1.2-1.2 2.9-1.8 4.6-1.4 3.4.8 4.8 4 3.1 7.3C19 16.4 12 21 12 21z"/>
            </svg>
          </button>
          <div class="actionCount likeCount">201</div>
        </div>

        <div class="actionStack">
          <button class="actionBtn commentBtn" type="button" aria-label="Comments">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 4h16v12H7l-3 3V4zm3 5h10v2H7V9zm0-4h10v2H7V5zm0 8h7v2H7v-2z"/>
            </svg>
          </button>
          <div class="actionCount commentCount">41</div>
        </div>
      </div>

      <div class="meta">
        <div class="metaTitle">@princecoffee</div>
        <div class="metaDesc">Late night vibes üåô Music + snacks.</div>
      </div>

      <div class="productCard" data-has-product="1">
        <img class="productImg" src="./images/getr√§nk1.png" alt="Product" />
        <div class="productInfo">
          <div class="productName">Fresh Juice</div>
          <div class="productPrice">3.50 ‚Ç¨</div>
        </div>
        <button class="productBtn" type="button">View</button>
      </div>
    </section>
  </main>

  <!-- COMMENTS (placeholder drawer) -->
  <aside class="comments" id="comments">
    <div class="commentsHeader">
      <div class="commentsTitle">Comments</div>
      <button class="commentsClose" id="commentsClose" type="button" aria-label="Close">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18.3 5.7L12 12l6.3 6.3-1.4 1.4L10.6 13.4 4.3 19.7 2.9 18.3 9.2 12 2.9 5.7 4.3 4.3l6.3 6.3 6.3-6.3 1.4 1.4z"/></svg>
      </button>
    </div>
    <div class="commentsBody">
      Demo-Placeholder.<br><br>
      Sp√§ter: Admin kann Kommentare moderieren + User k√∂nnen schreiben (Firestore).
    </div>
  </aside>

  <script type="module">
    // =========================================================
    // STORY PAGE ‚Äî TikTok-like feed (scroll-snap + autoplay)
    // Minimal & schnell
    // =========================================================
    const feed = document.getElementById("feed");
    const reels = Array.from(document.querySelectorAll(".reel"));
    const videos = Array.from(document.querySelectorAll(".reelVideo"));

    const backBtn = document.getElementById("backBtn");
    const comments = document.getElementById("comments");
    const commentsClose = document.getElementById("commentsClose");

    function goBack(){
      if (history.length > 1) history.back();
      else window.location.href = "./karte.html";
    }
    backBtn?.addEventListener("click", goBack);

    // --- Comments drawer ---
    function openComments(){ comments?.classList.add("open"); }
    function closeComments(){ comments?.classList.remove("open"); }
    commentsClose?.addEventListener("click", closeComments);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeComments();
    });

    // --- Like / Comment actions (delegation) ---
    document.addEventListener("click", (e) => {
      const reel = e.target.closest(".reel");
      if (!reel) return;

      // Like
      const likeBtn = e.target.closest(".likeBtn");
      if (likeBtn) {
        const stack = likeBtn.closest(".actionStack");
        const countEl = reel.querySelector(".likeCount");
        const current = parseInt((countEl?.textContent || "0").trim(), 10) || 0;

        const isLiked = likeBtn.classList.toggle("isLiked");
        const next = isLiked ? current + 1 : Math.max(0, current - 1);
        if (countEl) countEl.textContent = String(next);
        return;
      }

      // Comment
      const commentBtn = e.target.closest(".commentBtn");
      if (commentBtn) {
        openComments();
        return;
      }

      // Product card click
      const productBtn = e.target.closest(".productBtn");
      if (productBtn) {
        alert("Product √∂ffnen ‚úÖ (demo)");
        return;
      }
    });

    // --- Tap to pause/play on reel ---
    function showHint(reelEl, text){
      const hint = reelEl.querySelector(".tapHint");
      if (!hint) return;
      hint.textContent = text;
      hint.classList.add("show");
      window.setTimeout(() => hint.classList.remove("show"), 450);
    }

    reels.forEach((reelEl) => {
      reelEl.addEventListener("click", (e) => {
        // ignore if click on buttons/cards
        if (e.target.closest("button") || e.target.closest(".productCard")) return;

        const v = reelEl.querySelector("video");
        if (!v) return;

        if (v.paused) {
          v.play().catch(()=>{});
          showHint(reelEl, "Play");
        } else {
          v.pause();
          showHint(reelEl, "Paused");
        }
      }, { passive: true });
    });

    // --- Autoplay only visible reel ---
    function pauseAll(except){
      videos.forEach(v => {
        if (v === except) return;
        try { v.pause(); } catch {}
      });
    }

    const io = new IntersectionObserver((entries) => {
      // pick the most visible entry
      let best = null;
      for (const ent of entries) {
        if (!ent.isIntersecting) continue;
        if (!best || ent.intersectionRatio > best.intersectionRatio) best = ent;
      }
      if (!best) return;

      const activeReel = best.target;
      const v = activeReel.querySelector("video");
      if (!v) return;

      pauseAll(v);
      // autoplay needs muted + playsinline
      v.play().catch(()=>{});
    }, { root: feed, threshold: [0.55, 0.7, 0.85] });

    reels.forEach(r => io.observe(r));

    // --- Init: play first ---
    const first = videos[0];
    if (first) first.play().catch(()=>{});
  </script>
</body>
</html>
